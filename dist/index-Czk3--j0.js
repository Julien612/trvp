var z=Object.defineProperty;var G=(E,e,t)=>e in E?z(E,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):E[e]=t;var v=(E,e,t)=>(G(E,typeof e!="symbol"?e+"":e,t),t),F=(E,e,t)=>{if(!e.has(E))throw TypeError("Cannot "+t)};var i=(E,e,t)=>(F(E,e,"read from private field"),t?t.call(E):e.get(E)),H=(E,e,t)=>{if(e.has(E))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(E):e.set(E,t)},C=(E,e,t,n)=>(F(E,e,"write to private field"),n?n.call(E,t):e.set(E,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();class b{static async getTasklists(){try{const e=await fetch("http://localhost:5173/tasklists"),t=await e.json();return e.status!==200?Promise.reject(t):t.menus}catch(e){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:e.message})}}static async addTasklist({menuID:e,week_day:t,variant:n=null,position:s=-1}={menuID:null,week_day:"",variant:null,position:-1}){try{const a=await fetch("http://localhost:5173/tasklists",{method:"POST",body:JSON.stringify({menuID:e,week_day:t,variant:n,position:s}),headers:{"Content-Type":"application/json"}}),r=await a.json();return a.status!==200?Promise.reject(r):r.menus_rows}catch(a){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:a.message})}}static async updateTasklist({menuID:e,week_day:t,prev_week_day:n,variant:s=null,prev_variant:a=null,type_of_update:r}={menuID:null,week_day:"",prev_week_day:"",variant:null,prev_variant:null,type_of_update:r}){try{const c=await fetch(`http://localhost:5173/tasklists/${e}`,{method:"PATCH",body:JSON.stringify({week_day:t,prev_week_day:n,variant:s,prev_variant:a,type_of_update:r}),headers:{"Content-Type":"application/json"}}),o=await c.json();return c.status!==200?Promise.reject(o):o.menus_rows_length}catch(c){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:c.message})}}static async deleteTasklist({menuID:e}={menuID:null}){try{const t=await fetch(`http://localhost:5173/tasklists/${e}`,{method:"DELETE"});if(t.status!==200){const n=await t.json();return Promise.reject(n)}return{timestamp:new Date().toISOString()}}catch(t){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:t.message})}}static async deleteTask({dishID:e}={dishID:null}){try{const t=await fetch(`http://localhost:5173/tasks/${e}`,{method:"DELETE"});if(t.status!==200){const n=await t.json();return Promise.reject(n)}return{timestamp:new Date().toISOString(),message:`'${e}' было успешно удалено`}}catch(t){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:t.message})}}static async addTask({dishID:e,name:t,type:n,menuID:s}={dishID:null,name:"",type:"",menuID:null}){try{const a=await fetch("http://localhost:5173/tasks",{method:"POST",body:JSON.stringify({dishID:e,name:t,type:n,menuID:s}),headers:{"Content-Type":"application/json"}});if(a.status!==200){const r=await a.json();return Promise.reject(r)}return{timestamp:new Date().toISOString(),message:`позиция '${e}' была успешно изменена`}}catch(a){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:a.message})}}static async deleteTask({dishID:e}={dishID:null}){try{const t=await fetch(`http://localhost:5173/tasks/${e}`,{method:"DELETE"});if(t.status!==200){const n=await t.json();return Promise.reject(n)}return{timestamp:new Date().toISOString(),message:`позиция '${e}' была успешно изменена`}}catch(t){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:t.message})}}static async updateTask({dishID:e,name:t="",newType:n=""}={dishID:null,name:"",newType:""}){try{const s=await fetch(`http://localhost:5173/tasks/${e}`,{method:"PATCH",body:JSON.stringify({name:t,newType:n}),headers:{"Content-Type":"application/json"}});if(s.status!==200){const a=await s.json();return Promise.reject(a)}return{timestamp:new Date().toISOString(),message:`Параметры блюда '${t}' были успешно изменены`}}catch(s){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:s.message})}}static async moveTask({dishID:e,srcTasklistID:t,destTasklistID:n}={dishID:null,srcTasklistID:null,destTasklistID:null}){try{const s=await fetch("http://localhost:5173/tasklists",{method:"PATCH",body:JSON.stringify({dishID:e,srcTasklistID:t,destTasklistID:n}),headers:{"Content-Type":"application/json"}});if(s.status!==200){const a=await s.json();return Promise.reject(a)}return{timestamp:new Date().toISOString(),message:"Параметры задачи были успешно изменены"}}catch(s){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:s.message})}}}var D,A,$;class Q{constructor({dishID:e=null,name:t,type:n,onEditTask:s,onDeleteTask:a}){H(this,D,null);H(this,A,"");H(this,$,"");C(this,D,e||crypto.randomUUID()),C(this,A,t),C(this,$,n),this.onEditTask=s,this.onDeleteTask=a}get dishID(){return i(this,D)}get dishName(){return i(this,A)}set dishName(e){typeof e=="string"&&C(this,A,e)}get dishType(){return i(this,$)}set dishType(e){typeof e=="string"&&C(this,$,e)}render(){const e=document.createElement("li");e.classList.add("tasklist_tasks-list-item","task"),e.setAttribute("id",i(this,D)),e.setAttribute("draggable",!0),e.addEventListener("dragstart",u=>{u.target.classList.add("task_selected"),localStorage.setItem("movedTaskID",i(this,D))}),e.addEventListener("dragend",u=>u.target.classList.remove("task_selected"));const t=document.createElement("span");t.classList.add("task_text"),t.innerHTML=i(this,A),e.appendChild(t);const n=document.createElement("span");n.classList.add("task_text"),n.classList.add("task_type"),n.innerHTML=i(this,$),e.appendChild(n);const s=document.createElement("div");s.classList.add("task_controls");const a=document.createElement("div");a.classList.add("task_controls-row");const r=document.createElement("button");r.setAttribute("type","button"),r.classList.add("task_control-btn","edit-icon"),r.addEventListener("click",u=>{const p=document.getElementById(i(this,D)).getElementsByClassName("dropdown_task")[0];let g=u.target.parentElement.parentElement.parentElement.children;for(let w of g)w.style.display="none";p.style.display="block",p.focus()}),a.appendChild(r);const c=document.createElement("button");c.setAttribute("type","button"),c.classList.add("task_control-btn","delete-icon"),c.addEventListener("click",()=>this.onDeleteTask({dishID:i(this,D)})),a.appendChild(c),s.appendChild(a),e.appendChild(s);const o=document.createElement("div");o.classList.add("dropdown_task"),o.id=this.dishID;const d=document.createElement("button");d.classList.add("dropbtn"),d.innerHTML="Choose new meal type";const m=document.createElement("div");m.classList.add("dropdown-content");const l=document.createElement("a");l.innerHTML="Salad";const f=document.createElement("a");f.innerHTML="Soup";const T=document.createElement("a");T.innerHTML="Main dish";const I=document.createElement("a");I.innerHTML="Drink";const L=document.createElement("a");return L.innerHTML="Dessert",m.appendChild(l),m.appendChild(f),m.appendChild(T),m.appendChild(I),m.appendChild(L),o.appendChild(m),o.appendChild(d),I.addEventListener("click",u=>{const p=document.getElementById(i(this,D)).getElementsByClassName("dropdown_task")[0];this.onEditTask({dishID:i(this,D),newType:u.target.innerHTML});let g=u.target.parentElement.parentElement.parentElement.children;for(let w of g)w.style.display="inherit";p.style.display="none"}),f.addEventListener("click",u=>{const p=document.getElementById(i(this,D)).getElementsByClassName("dropdown_task")[0];this.onEditTask({dishID:i(this,D),newType:u.target.innerHTML});let g=u.target.parentElement.parentElement.parentElement.children;for(let w of g)w.style.display="inherit";p.style.display="none"}),T.addEventListener("click",u=>{const p=document.getElementById(i(this,D)).getElementsByClassName("dropdown_task")[0];this.onEditTask({dishID:i(this,D),newType:u.target.innerHTML});let g=u.target.parentElement.parentElement.parentElement.children;for(let w of g)w.style.display="inherit";p.style.display="none"}),L.addEventListener("click",u=>{const p=document.getElementById(i(this,D)).getElementsByClassName("dropdown_task")[0];this.onEditTask({dishID:i(this,D),newType:u.target.innerHTML});let g=u.target.parentElement.parentElement.parentElement.children;for(let w of g)w.style.display="inherit";p.style.display="none"}),l.addEventListener("click",u=>{const p=document.getElementById(i(this,D)).getElementsByClassName("dropdown_task")[0];this.onEditTask({dishID:i(this,D),newType:u.target.innerHTML});let g=u.target.parentElement.parentElement.parentElement.children;for(let w of g)w.style.display="inherit";p.style.display="none"}),e.appendChild(o),e}}D=new WeakMap,A=new WeakMap,$=new WeakMap;var B,h,j,N,P;class K{constructor({menuID:e=null,week_day:t,variant:n,position:s,onEditTasklist:a,onDeleteTasklist:r,onDeleteTask:c,onEditTask:o,onDropTaskInTasklist:d,addNotification:m}){H(this,B,[]);H(this,h,null);H(this,j,"");H(this,N,void 0);H(this,P,-1);v(this,"pushTask",({dish:e})=>i(this,B).push(e));v(this,"getTaskById",({dishID:e})=>i(this,B).find(t=>t.dishID===e));v(this,"deleteTask",({dishID:e})=>{const t=i(this,B).findIndex(s=>s.dishID===e);if(t===-1)return;const[n]=i(this,B).splice(t,1);return n});v(this,"reorderTasks",async()=>{const e=Array.from(document.querySelector(`[id="${i(this,h)}"] .tasklist_tasks-list`).children,n=>n.getAttribute("id")),t=[];if(e.forEach((n,s)=>{const a=i(this,B).find(r=>r.dishID===n);a.taskPosition!==s&&(a.taskPosition=s,t.push({dishID:n,position:s}))}),t.length>0)try{await b.updateTasks({reorderedTasks:t})}catch(n){console.error(n)}});v(this,"onAddNewTask",async e=>{const t=prompt("Введите название блюда:");if(t)try{const n=crypto.randomUUID(),s=await b.addTask({dishID:n,name:t,type:e,menuID:i(this,h)});this.addNewTaskLocal({dishID:n,name:t,type:e}),console.log(s)}catch(n){this.addNotification({text:n.message,type:"error"}),console.error(n)}});v(this,"addNewTaskLocal",({dishID:e=null,name:t,type:n})=>{const s=new Q({dishID:e,name:t,type:n,onEditTask:this.onEditTask,onDeleteTask:this.onDeleteTask});i(this,B).push(s);const a=s.render();let r=document.querySelectorAll(`[id="${i(this,h)}"] .task_type`),c=null,o=null,d=null,m=null;for(let f of r)f.innerHTML==="Salad"?f.parentElement:f.innerHTML==="Soup"?c=f.parentElement:f.innerHTML==="Main dish"?o=f.parentElement:f.innerHTML==="Dessert"?d=f.parentElement:f.innerHTML==="Drink"&&(m=f.parentElement);let l=null;n==="Salad"?c?l=c:o?l=o:d?l=d:m&&(l=m):n==="Soup"?o?l=o:d?l=d:m&&(l=m):n==="Main dish"?d?l=d:m&&(l=m):n==="Dessert"&&m&&(l=m),document.querySelector(`[id="${i(this,h)}"] .tasklist_tasks-list`).insertBefore(a,l)});C(this,j,t),C(this,h,e||crypto.randomUUID()),C(this,P,s),C(this,N,n),this.onEditTasklist=a,this.onDeleteTasklist=r,this.onDeleteTask=c,this.onEditTask=o,this.onDropTaskInTasklist=d,this.addNotification=m}get menuID(){return i(this,h)}get menuWeekDay(){return i(this,j)}set menuWeekDay(e){typeof e=="string"&&C(this,j,e)}get dishes(){return i(this,B)}get menuVariant(){return i(this,N)}set menuVariant(e){C(this,N,e)}get tasklistPosition(){return i(this,P)}render(){const e=document.createElement("li");e.classList.add("tasklists-list_item","tasklist"),e.setAttribute("id",i(this,h)),e.addEventListener("dragstart",y=>{localStorage.setItem("srcTasklistID",i(this,h))}),e.addEventListener("dragend",y=>{y.target.classList.remove("task_selected")}),e.addEventListener("drop",this.onDropTaskInTasklist);const t=document.createElement("div");t.classList.add("task_controls");const n=document.createElement("div");n.classList.add("task_controls-row");const s=document.createElement("h2");s.classList.add("tasklist_name"),s.innerHTML=i(this,j),n.appendChild(s);const a=document.createElement("button");a.setAttribute("type","button"),a.classList.add("task_control-btn","edit-icon"),a.addEventListener("click",y=>{const k=document.querySelector(`[id="${i(this,h)}"] .dropdown-edit`);k.style.display="inherit"}),n.appendChild(a);const r=document.createElement("div");r.classList.add("dropdown-edit"),r.id=this.menuID;const c=document.createElement("button");c.classList.add("dropbtn"),c.innerHTML="Choose new week day";const o=document.createElement("div");o.classList.add("dropdown-content");const d=document.createElement("a");d.innerHTML="Monday";const m=document.createElement("a");m.innerHTML="Tuesday";const l=document.createElement("a");l.innerHTML="Wednesday";const f=document.createElement("a");f.innerHTML="Thursday";const T=document.createElement("a");T.innerHTML="Friday";const I=document.createElement("a");I.innerHTML="Saturday";const L=document.createElement("a");L.innerHTML="Sunday",o.appendChild(d),o.appendChild(m),o.appendChild(T),o.appendChild(l),o.appendChild(f),o.appendChild(I),o.appendChild(L),r.appendChild(o),r.appendChild(c),d.addEventListener("click",y=>{const k=document.querySelector(`[id="${i(this,h)}"] .dropdown-edit`);k.style.display="none",this.onEditTasklist({menuID:i(this,h),newWeekDay:y.target.innerHTML,type_of_update:0})}),m.addEventListener("click",y=>{const k=document.querySelector(`[id="${i(this,h)}"] .dropdown-edit`);k.style.display="none",this.onEditTasklist({menuID:i(this,h),newWeekDay:y.target.innerHTML,type_of_update:0})}),l.addEventListener("click",y=>{const k=document.querySelector(`[id="${i(this,h)}"] .dropdown-edit`);k.style.display="none",this.onEditTasklist({menuID:i(this,h),newWeekDay:y.target.innerHTML,type_of_update:0})}),f.addEventListener("click",y=>{const k=document.querySelector(`[id="${i(this,h)}"] .dropdown-edit`);k.style.display="none",this.onEditTasklist({menuID:i(this,h),newWeekDay:y.target.innerHTML,type_of_update:0})}),T.addEventListener("click",y=>{const k=document.querySelector(`[id="${i(this,h)}"] .dropdown-edit`);k.style.display="none",this.onEditTasklist({menuID:i(this,h),newWeekDay:y.target.innerHTML,type_of_update:0})}),L.addEventListener("click",y=>{const k=document.querySelector(`[id="${i(this,h)}"] .dropdown-edit`);k.style.display="none",this.onEditTasklist({menuID:i(this,h),newWeekDay:y.target.innerHTML,type_of_update:0})}),I.addEventListener("click",y=>{const k=document.querySelector(`[id="${i(this,h)}"] .dropdown-edit`);k.style.display="none",this.onEditTasklist({menuID:i(this,h),newWeekDay:y.target.innerHTML,type_of_update:0})});const u=document.createElement("h1");u.classList.add("tasklist_name"),i(this,N)!==null&&(u.innerHTML=i(this,N)),n.appendChild(u);const p=document.createElement("button");p.setAttribute("type","button"),p.classList.add("task_control-btn","edit-icon"),p.addEventListener("click",()=>this.onEditTasklist({menuID:i(this,h),type_of_update:1})),n.appendChild(p);const g=document.createElement("button");g.setAttribute("type","button"),g.classList.add("task_control-btn","delete-icon"),g.addEventListener("click",()=>this.onDeleteTasklist({menuID:i(this,h)})),t.appendChild(g),t.appendChild(n),e.appendChild(t),e.appendChild(r);const w=document.createElement("ul");w.classList.add("tasklist_tasks-list"),e.appendChild(w);const _=document.createElement("button");_.setAttribute("type","button"),_.classList.add("tasklist_add-task-btn"),_.innerHTML="&#10010 Add dish",_.addEventListener("click",y=>{const k=document.getElementById(i(this,h)).getElementsByClassName("dropdown")[0];k.style.display="inherit",k.focus()});const M=document.createElement("div");M.classList.add("dropdown"),M.id=this.menuID;const O=document.createElement("button");O.classList.add("dropbtn"),O.innerHTML="Choose meal type";const q=document.createElement("div");q.classList.add("dropdown-content");const V=document.createElement("a");V.innerHTML="Salad";const W=document.createElement("a");W.innerHTML="Soup";const R=document.createElement("a");R.innerHTML="Main dish";const U=document.createElement("a");U.innerHTML="Drink";const x=document.createElement("a");x.innerHTML="Dessert",q.appendChild(V),q.appendChild(W),q.appendChild(R),q.appendChild(U),q.appendChild(x),M.appendChild(q),M.appendChild(O),U.addEventListener("click",y=>{const k=document.getElementById(i(this,h)).getElementsByClassName("dropdown")[0];k.style.display="none",this.onAddNewTask(y.target.innerHTML)}),W.addEventListener("click",y=>{const k=document.getElementById(i(this,h)).getElementsByClassName("dropdown")[0];k.style.display="none",this.onAddNewTask(y.target.innerHTML)}),R.addEventListener("click",y=>{const k=document.getElementById(i(this,h)).getElementsByClassName("dropdown")[0];k.style.display="none",this.onAddNewTask(y.target.innerHTML)}),x.addEventListener("click",y=>{const k=document.getElementById(i(this,h)).getElementsByClassName("dropdown")[0];k.style.display="none",this.onAddNewTask(y.target.innerHTML)}),V.addEventListener("click",y=>{const k=document.getElementById(i(this,h)).getElementsByClassName("dropdown")[0];k.style.display="none",this.onAddNewTask(y.target.innerHTML)}),e.appendChild(M),e.appendChild(_);const J=document.querySelector(".tasklist-adder");J.parentElement.insertBefore(e,J)}}B=new WeakMap,h=new WeakMap,j=new WeakMap,N=new WeakMap,P=new WeakMap;var S;class X{constructor(){H(this,S,[]);v(this,"onAddNewMenu",async e=>{const t=crypto.randomUUID();try{const a=await b.addTasklist({menuID:t,week_day:e,position:i(this,S).length});var n;a.length+1>1?(n=a.length+1,a.length+1===2&&(document.querySelector(`[id="${a[0].id}"] h1.tasklist_name`).innerHTML="1")):n=null;const r=new K({menuID:t,week_day:e,variant:n,position:i(this,S).length,onDropTaskInTasklist:this.onDropTaskInTasklist,addNotification:this.addNotification,onEditTasklist:this.onEditTasklist,onDeleteTasklist:this.onDeleteTasklist,onDeleteTask:this.onDeleteTask,onEditTask:this.onEditTask});i(this,S).push(r),r.render()}catch(a){console.error(a)}const s=document.querySelector(".dropdown-add-menu");s.style.display="none",document.querySelector(".tasklist-adder_btn").style.display="inherit"});v(this,"onEditTasklist",async({menuID:e,newWeekDay:t,type_of_update:n})=>{let s=null;for(let d of i(this,S))if(s=d,e===s.menuID)break;const a=s.menuWeekDay,r=s.menuVariant;let c=null,o=null;try{if(n===0){if(!a||t===a)return;if(s.menuWeekDay=t,document.querySelector(`[id="${e}"]  h2.tasklist_name`).innerHTML=t,r>0){let d=null,m=0;for(let l of i(this,S))a===l.menuWeekDay&&(m++,l.menuVariant>r&&(document.querySelector(`[id="${l.menuID}"]  h1.tasklist_name`).innerHTML=l.menuVariant-1,l.menuVariant=l.menuVariant-1),l.menuVariant<r&&(d=l));m===1&&(document.querySelector(`[id="${d.menuID}"]  h1.tasklist_name`).innerHTML=null,d.menuVariant=null),m>0&&(o=a)}if(c=await b.updateTasklist({menuID:e,week_day:t,prev_week_day:o,variant:r,prev_variant:null,type_of_update:n}),c===1)c=null;else if(c===2){let d=null;for(let m of i(this,S))if(d=m,t===d.menuWeekDay&&d.menuID!==e)break;d.menuVariant=1,document.querySelector(`[id="${d.menuID}"]  h1.tasklist_name`).innerHTML="1"}}else{if(c=parseInt(prompt("Введите новый вариант")),!r||c===r)return;let d=r,m=0;for(let l of i(this,S))c===l.menuVariant&&a===l.menuWeekDay&&(l.menuVariant=r,m=l.menuID);if(m===0)return;s.menuVariant=c,document.querySelector(`[id="${m}"]  h1.tasklist_name`).innerHTML=r,console.log(c,r),await b.updateTasklist({menuID:e,week_day:a,prev_week_day:null,variant:c,prev_variant:d,type_of_update:n})}document.querySelector(`[id="${e}"]  h1.tasklist_name`).innerHTML=c}catch(d){console.error(d)}});v(this,"onEditTask",async({dishID:e,newType:t})=>{let n=null,s=null;for(let o of i(this,S))if(n=o.getTaskById({dishID:e}),n){s=o;break}let a=s.dishes;for(let o of a)if(n!==o&&o.dishType===t){alert("Такой тип блюда уже есть");return}const r=n.dishName,c=prompt("Введите новое название блюда");if(!(!c||c===r))try{n.dishName=c,document.querySelector(`[id="${e}"] span.task_text`).innerHTML=c,n.dishType=t,document.querySelector(`[id="${e}"] span.task_type`).innerHTML=t;const o=await b.updateTask({dishID:e,name:c,newType:t});console.log(o);let d=document.getElementById(e);console.log(d);let m=document.querySelectorAll(`[id="${s.menuID}"] .task_type`),l=null,f=null,T=null,I=null,L=null;for(let p of m)p.innerHTML==="Salad"?l=p.parentElement:p.innerHTML==="Soup"?f=p.parentElement:p.innerHTML==="Main dish"?T=p.parentElement:p.innerHTML==="Dessert"?I=p.parentElement:p.innerHTML==="Drink"&&(L=p.parentElement);let u=null;t==="Salad"?f?u=f:T?u=T:I?u=I:L&&(u=L):t==="Soup"?T?u=T:I?u=I:L&&(u=L):t==="Main dish"?I?u=I:L&&(u=L):t==="Dessert"&&L&&(u=L),document.querySelector(`[id="${s.menuID}"] .tasklist_tasks-list`).removeChild(d),document.querySelector(`[id="${s.menuID}"] .tasklist_tasks-list`).insertBefore(d,u)}catch(o){console.error(o)}});v(this,"onDeleteTasklist",async({menuID:e})=>{let t=null;for(let r of i(this,S))if(e===r.menuID&&(t=r),t)break;let n=0,s=null;for(let r of i(this,S))t.menuWeekDay===r.menuWeekDay&&t.menuVariant<r.menuVariant&&(document.querySelector(`[id="${r.menuID}"]  h1.tasklist_name`).innerHTML=r.menuVariant-1),t.menuWeekDay===r.menuWeekDay&&(n++,t!==r&&(s=r));if(n===2&&(document.querySelector(`[id="${s.menuID}"]  h1.tasklist_name`).innerHTML=null),!!confirm("Меню будет удалено. Продолжить?"))try{const r=await b.deleteTasklist({menuID:e});i(this,S).splice(t,1),document.getElementById(e).remove(),console.log(r)}catch(r){console.error(r)}});v(this,"onDeleteTask",async({dishID:e})=>{let t=null,n=null;for(let a of i(this,S))if(n=a,t=a.getTaskById({dishID:e}),t)break;if(confirm("Позиция будет удалена. Продолжить?"))try{const a=await b.deleteTask({dishID:e});n.deleteTask({dishID:e}),document.getElementById(e).remove(),console.log(a)}catch(a){console.error(a)}});v(this,"onDropTaskInTasklist",async e=>{e.stopPropagation();const t=e.currentTarget;t.classList.remove("tasklist_droppable");const n=localStorage.getItem("movedTaskID"),s=localStorage.getItem("srcTasklistID"),a=t.getAttribute("id");if(localStorage.setItem("movedTaskID",""),localStorage.setItem("srcTasklistID",""),!t.querySelector(`[id="${n}"]`))return;const r=i(this,S).find(o=>o.menuID===s),c=i(this,S).find(o=>o.menuID===a);try{if(s!==a){await b.moveTask({dishID:n,srcTasklistID:s,destTasklistID:a});const o=r.deleteTask({dishID:n});c.pushTask({dish:o})}console.log("блюдо перемещено")}catch(o){console.error(o)}});v(this,"addNotification",({text:e,type:t})=>{let n=document.getElementById("app-notifications");const s=crypto.randomUUID(),a=document.createElement("div");a.classList.add("notification",t==="success"?"notification-success":"notification-error"),a.setAttribute("id",s),a.innerHTML=e,n.appendChild(a),setTimeout(()=>{document.getElementById(s).remove()},5e3)})}initNotifications(){document.getElementById("app-notifications").show()}async init(){document.querySelector(".tasklist-adder_btn").addEventListener("click",o=>{o.target.style.display="none";const d=document.querySelector(".dropdown-add-menu");d.style.display="inherit",d.focus()});const e=document.querySelector(".mon-weekday"),t=document.querySelector(".tue-weekday"),n=document.querySelector(".wed-weekday"),s=document.querySelector(".thu-weekday"),a=document.querySelector(".fri-weekday"),r=document.querySelector(".sat-weekday"),c=document.querySelector(".sun-weekday");e.addEventListener("click",o=>{const d=document.getElementsByClassName("dropdown-add-menu")[0];d.style.display="none",this.onAddNewMenu(o.target.innerHTML)}),t.addEventListener("click",o=>{const d=document.getElementsByClassName("dropdown-add-menu")[0];d.style.display="none",this.onAddNewMenu(o.target.innerHTML)}),n.addEventListener("click",o=>{const d=document.getElementsByClassName("dropdown-add-menu")[0];d.style.display="none",this.onAddNewMenu(o.target.innerHTML)}),s.addEventListener("click",o=>{const d=document.getElementsByClassName("dropdown-add-menu")[0];d.style.display="none",this.onAddNewMenu(o.target.innerHTML)}),a.addEventListener("click",o=>{const d=document.getElementsByClassName("dropdown-add-menu")[0];d.style.display="none",this.onAddNewMenu(o.target.innerHTML)}),r.addEventListener("click",o=>{const d=document.getElementsByClassName("dropdown")[0];d.style.display="none",this.onAddNewMenu(o.target.innerHTML)}),c.addEventListener("click",o=>{const d=document.getElementsByClassName("dropdown")[0];d.style.display="none",this.onAddNewMenu(o.target.innerHTML)}),document.getElementById("theme-switch").addEventListener("change",o=>{o.target.checked?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")}),this.initNotifications(),document.addEventListener("dragover",o=>{o.preventDefault();const d=document.querySelector(".task.task_selected"),m=d.closest(".tasklist"),l=o.target,f=document.querySelector(".tasklist_droppable");let T=o.target;for(;!T.matches(".tasklist")&&T!==document.body;)T=T.parentElement;if(T!==f&&(f&&f.classList.remove("tasklist_droppable"),T.matches(".tasklist")&&T.classList.add("tasklist_droppable")),!(!T.matches(".tasklist")||d===l)&&T!==m){if(l.matches(".task")){let I=T.querySelectorAll(".task_type"),L=d.querySelector(".task_type").innerHTML,u=null,p=null,g=null,w=null;for(let M of I)M.innerHTML==="Salad"?M.parentElement:M.innerHTML==="Soup"?u=M.parentElement:M.innerHTML==="Main dish"?p=M.parentElement:M.innerHTML==="Dessert"?g=M.parentElement:M.innerHTML==="Drink"&&(w=M.parentElement);let _=null;L==="Salad"?u?_=u:p?_=p:g?_=g:w&&(_=w):L==="Soup"?p?_=p:g?_=g:w&&(_=w):L==="Main dish"?g?_=g:w&&(_=w):L==="Dessert"&&w&&(_=w),T.querySelector(".tasklist_tasks-list").insertBefore(d,_);return}T.querySelector(".tasklist_tasks-list").children.length||T.querySelector(".tasklist_tasks-list").appendChild(d)}});try{const o=await b.getTasklists();for(const d of o){const m=new K({menuID:d.menuID,week_day:d.week_day,variant:d.variant,position:d.position,onEditTasklist:this.onEditTasklist,onDeleteTasklist:this.onDeleteTasklist,onDeleteTask:this.onDeleteTask,onEditTask:this.onEditTask,onDropTaskInTasklist:this.onDropTaskInTasklist,addNotification:this.addNotification});i(this,S).push(m),m.render();for(const l of d.dishes)m.addNewTaskLocal({dishID:l.dishID,name:l.name,type:l.type})}}catch(o){console.error(o)}}}S=new WeakMap;document.addEventListener("DOMContentLoaded",()=>{new X().init()});
